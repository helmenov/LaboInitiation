# メールの設定

## 研究室メール

`kiyasu-lab@cis.nagasaki-u.ac.jp`

です．演習室のあるホストが qmail という SMTP サーバソフトで管理しています．

研究室の諸々の連絡・相談は，このメール宛に投稿されます．

このメールは，皆さんの `bb********@ms.nagasaki-u.ac.jp` というメールアドレスに転送され，受信されます．4 月新配属のタイミングで転送先リストが更新されます．

## 皆さんの持つメールアドレス

皆さんは，知ってか知らずか大学から次のメールアドレスを割り振られています

1. 情報演習室のメールアドレス：`b31****@cis.nagasaki-u.ac.jp`
2. 大学のメールアドレス：`bb********@ms.nagasaki-u.ac.jp`
   1. 学部時代のメールアドレス: `bb3531****@ms.nagasaki-u.ac.jp`
   2. 大学院時代のメールアドレス：`bb5211****@ms.nagasaki-u.ac.jp`

このうち，情報演習室のメアド`@cis`は，大学に在籍中ずっと利用できます．
大学のメアド`@ms`は，学部時代と大学院時代で異なります．大学院に進学すると，新しいメアドが作られ，学部時代のメアドは消されます．

### ※職員の持つメールアドレス

職員は 3 つ持っています．

1. 情報演習室のメールアドレス：`***@cis.nagasaki-u.ac.jp`
2. 大学のメールアドレス１（MicroSoft）：`aa********@ms.nagasaki-u.ac.jp`
   1. office365 と連携
   2. LACS と連携
3. 大学のメールアドレス２（基盤センター）：`***@nagasaki-u.ac.jp`

## メールの仕組み

メールは，

1. メーラー(MUA)によって読み書きされ，
2. 送信サーバ(SMTP)によって送信され，
3. 別の送信サーバ(SMTP)によって送信され，
4. ...
5. 最後に受信サーバ(POP,IMAP)によってメールボックスに届き，
6. メーラー(MUA)によって読み書きされます．

### 受信サーバ（メールを溜めるメールボックス）

自宅の郵便受けや，私書箱との通信です．

メアド`@ms`は，IMAP（サーバ上で読む）と POP (サーバからダウンロードしてローカルで読む)が利用できます．

- IMAP 方式は，郵便受けの中で仕分けするイメージ
- POP 方式は，郵便受けの中をごっそり引き取ってくるイメージ

メアド`@cis`は，POP のみ利用できます．IMAP は利用できません．

### 送信サーバ（メールを送信する．転送する）

実は送信はメアドと関係ありません．どこの SMTP サーバでも送信できます．
つまり，郵便局です．送り主がどの住所であろうと，どの郵便局にも投函できます．

ただし，From のメアドのドメイン　と　 SMTP のドメイン　が一致していないと信頼されない場合がある，というだけです．たいがいの受信サーバは送信サーバも兼任しています．

#### メールの転送設定

演習室`@cis`の SMTP は，`.forward`というファイルに転送先を書くことでメール転送をおこないます．

- 複数の宛先があれば，複数行に分けて書きます
- @以下が同じ宛先であれば，@以下を省略できます．
- 頭に`\`（バックスラッシュ）を付けるとループしません．

### メーラー（メールを読み書きする）

有名どころで，Thunderbird，Outlook，GMail でしょうか．
いずれも，受信サーバと送信サーバを設定します．

`@ms`の POP,IMAP,SMTP のサーバ名は，

- ユーザー名 `bb********@ms.nagasaki-u.ac.jp`
- POP サーバー　`outlook.office365.com` ポート 995 暗号化 TLS
- IMAP サーバー `outlook.office365.com` ポート 993 暗号化 TLS
- SMTP サーバー `smtp.office365.com` ポート 587 暗号化 STARTTLS

`@cis`の POP,SMTP のサーバ名は，

- ユーザ名 `b******`
- POP サーバ　`mailserver.cis.nagasaki-u.ac.jp` ポート 110
- SMTP サーバ　`mailserver.cis.nagasaki-u.ac.jp` ポート 25

です．これらは暗号化ポートではなく，POP は plain パスワード認証．SMTP は POP-before-SMTP（SMTP アクセスのためにまず POP アクセスする）です．

`@cis`のサーバは外部から利用しにくいため，私は，`@cis`は`@ms`へ転送（`.forward`）して`@ms`に pop または imap アクセスしています．

## GMail を使う

GMail は，`***@gmail.com`の受信サーバであり，送信サーバであり，メーラーです．

もちろん`***@gmail.com`に届いたメールを読んだり，文章を書いて`***@gmail.com`からメールを送信することができます．

が，普通のメーラーと同様に，受信サーバを設定すれば，他のドメインのメアドも読めます．送信サーバを設定すれば，他のドメインのメアドからメールを出せます．

GMail の`[設定]`-`[アカウントとインポート]`に

- `[名前]`
- `[他のアカウントのメールを確認]`

という項目があります．

- `[名前]`が送信サーバの設定です．SMTP サーバを設定します．
- `[他のアカウントのメールを確認]`が受信サーバの設定です．POP サーバを設定します．（IMAP 非対応）

### GMail で`@ms`や`@cis`のメールを読む

`[他のアカウントのメールを確認]`で`[メールアカウントを追加する]`を選び，
メールアドレスを指定すると，pop3 サーバの設定に進みます．
メアドから自動で POP3 サーバの名前が推定されますが，ここで手動で POP3 サーバを指定しても構いません．

### GMail で`@ms`や`@cis`からメールを出す

`[名前]`で`[他のメールアドレスを追加]`を選び，メールアドレスを指定すると，SMTP サーバの確認があります．

メアドから自動で SMTP サーバの名前が推定されますが，ここで手動で SMTP サーバを指定しても構いません．Gmail 自身の SMTP を指定しても構いません．

`[デフォルトの返信モードを選択]`は`[メールを受信したアドレスから返信する]`にチェックすること．

## Thunderbird, Outlook などを使う

受信サーバの設定で，`@ms`のメアドに届いたメールを読めます．

送信サーバの設定をすることで，書いたメールを`@ms`から送信できます．

## まとめ

| メールドメイン              | POP3 サーバ                       | POP3 ポート | POP3 暗号化 | IMAP4 サーバ                   | IMAP4 ポート | IMAP4 暗号化 | SMTP サーバ                       | SMTP ポート | SMTP 暗号化        |
| --------------------------- | --------------------------------- | ----------- | ----------- | ------------------------------ | ------------ | ------------ | --------------------------------- | ----------- | ------------------ |
| `****@cis.nagasaki-u.ac.jp` | `mailserver.cis.nagasaki-u.ac.jp` | 110         | PLAIN       | -                              | -            | -            | `mailserver.cis.nagasaki-u.ac.jp` | 25          | -(pop_before_smtp) |
| `****@ms.nagasaki-u.ac.jp`  | `outlook.office365.com`           | 995         | TLS         | `outlook.office365.com`        | 993          | TLS          | `smtp.office365.com`              | 587         | TLS                |
| `****@nagasaki-u.ac.jp`     | `mboxhost.cc.nagasaki-u.ac.jp`    | 995         | TLS         | `mboxhost.cc.nagasaki-u.ac.jp` | 993          | TLS          | `mboxhost.cc.nagasaki-u.ac.jp`    | 587         | TLS                |
